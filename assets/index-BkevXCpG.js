import{c as d,j as a,l as O}from"./theme-provider-BcuaeRf2.js";import{v as R,w as M,u as B,A as T,o as $,p as G,U as H,B as c,X as J,l as r}from"./App-BLCWYwP6.js";import{a as j,b as C,C as W,T as X,c as E,d as Y,P as _,e as S,I as q,S as K,L as Q,F as V}from"./input-DQrC9p7U.js";import"./index-BodsaVgx.js";var Z="Label",z=d.forwardRef((t,e)=>a.jsx(R.label,{...t,ref:e,onMouseDown:i=>{var o;i.target.closest("button, input, select, textarea")||((o=t.onMouseDown)==null||o.call(t,i),!i.defaultPrevented&&i.detail>1&&i.preventDefault())}}));z.displayName=Z;var ee=z;function x({className:t,...e}){return a.jsx(ee,{"data-slot":"label",className:M("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...e})}function re(){var b,w;const{user:t,profile:e,avatar:i,isLoading:p}=B(),o=O(),[g,f]=d.useState(!1),[h,m]=d.useState(!1),[n,N]=d.useState({firstName:"",lastName:"",fullName:""}),v=d.useRef(null);if(d.useEffect(()=>{e&&N({firstName:e.firstName||"",lastName:e.lastName||"",fullName:e.fullName||""})},[e]),p)return a.jsx("div",{className:"flex min-h-screen items-center justify-center",children:a.jsx("div",{className:"border-primary h-8 w-8 animate-spin rounded-full border-b-2"})});const F=async()=>{try{await r.auth.signOut(),o("/")}catch(s){throw console.error(s)}},y=async()=>{if(e!=null&&e.profilePicture)try{await r.storage.delete(e.profilePicture)}catch(s){console.error("Failed to delete old profile picture:",s)}},A=async s=>{if(t!=null&&t.id){m(!0);try{await y();const l=Date.now(),u=s.name.split(".").pop()||"jpg",P=`profiles/${t.id}/avatar_${l}.${u}`,U={contentType:s.type,contentDisposition:"inline"};await r.storage.uploadFile(P,s,U),await r.transact([r.tx.profiles[(e==null?void 0:e.id)||t.id].update({profilePicture:P,updatedAt:new Date().toISOString()})])}catch(l){console.error("Error uploading photo:",l)}finally{m(!1),o("/setting")}}},k=async()=>{if(!(!(t!=null&&t.id)||!(e!=null&&e.profilePicture))){m(!0);try{await y(),await r.transact([r.tx.profiles[e.id||t.id].update({profilePicture:"",updatedAt:new Date().toISOString()})])}catch(s){console.error("Error removing photo:",s)}finally{m(!1)}}},D=s=>{var u;const l=(u=s.target.files)==null?void 0:u[0];if(l){if(!l.type.startsWith("image/")){alert("Please select an image file.");return}if(l.size>5*1024*1024){alert("Please select an image smaller than 5MB.");return}A(l)}s.target.value=""},I=async()=>{if(t!=null&&t.id)try{const s={};n.firstName!==(e==null?void 0:e.firstName)&&(s.firstName=n.firstName),n.lastName!==(e==null?void 0:e.lastName)&&(s.lastName=n.lastName),n.fullName!==(e==null?void 0:e.fullName)&&(s.fullName=n.fullName),Object.keys(s).length>0&&(s.updatedAt=new Date().toISOString(),await r.transact([r.tx.profiles[(e==null?void 0:e.id)||t.id].update(s)])),f(!1)}catch(s){console.error("Error updating profile:",s)}},L=()=>{N({firstName:(e==null?void 0:e.firstName)||"",lastName:(e==null?void 0:e.lastName)||"",fullName:(e==null?void 0:e.fullName)||""}),f(!1)};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"flex items-center justify-between space-y-2 pt-6 pb-4",children:a.jsx("h1",{className:"my-1 text-3xl font-semibold tracking-tight",children:"Your Profile"})}),a.jsxs("div",{className:"mx-auto max-w-2xl space-y-6",children:[a.jsx(j,{children:a.jsxs(C,{className:"text-center",children:[a.jsxs("div",{className:"relative mx-auto",children:[a.jsxs(T,{className:"mx-auto h-24 w-24",children:[a.jsx($,{src:i||(e==null?void 0:e.profilePicture),alt:(e==null?void 0:e.fullName)||(t==null?void 0:t.email)||"User"}),a.jsx(G,{className:"text-lg",children:((b=e==null?void 0:e.firstName)==null?void 0:b.charAt(0))||((w=t==null?void 0:t.email)==null?void 0:w.charAt(0))||a.jsx(H,{size:24})})]}),a.jsx(c,{size:"sm",variant:"secondary",className:"absolute -right-2 -bottom-2 h-8 w-8 rounded-full p-0",onClick:()=>{var s;return(s=v.current)==null?void 0:s.click()},disabled:h,title:"Change profile picture",children:h?a.jsx("div",{className:"border-primary h-4 w-4 animate-spin rounded-full border-b-2"}):a.jsx(W,{size:14})}),(e==null?void 0:e.profilePicture)&&!h&&a.jsx(c,{size:"sm",variant:"destructive",className:"absolute -bottom-2 -left-2 h-8 w-8 rounded-full p-0",onClick:k,title:"Remove profile picture",children:a.jsx(X,{size:14})}),a.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:D,className:"hidden"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(E,{className:"text-xl",children:(e==null?void 0:e.fullName)||"Unnamed User"}),a.jsx(Y,{className:"text-sm",children:t==null?void 0:t.email})]}),a.jsx("p",{className:"text-muted-foreground mt-2 text-xs",children:"Click camera icon to upload • Max 5MB • JPG, PNG, GIF supported"})]})}),a.jsxs(j,{children:[a.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(E,{className:"text-lg",children:"Profile Information"}),a.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>f(!0),disabled:g,children:[a.jsx(_,{size:14,className:"mr-2"}),"Edit"]})]}),a.jsx(S,{className:"space-y-4",children:g?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(x,{htmlFor:"fullName",children:"Full Name"}),a.jsx(q,{id:"fullName",value:n.fullName,onChange:s=>N(l=>({...l,fullName:s.target.value})),placeholder:"Enter your full name"})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsxs(c,{onClick:I,size:"sm",children:[a.jsx(K,{size:14,className:"mr-2"}),"Save Changes"]}),a.jsxs(c,{variant:"outline",onClick:L,size:"sm",children:[a.jsx(J,{size:14,className:"mr-2"}),"Cancel"]})]})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx(x,{className:"text-muted-foreground text-sm font-medium",children:"Full Name"}),a.jsx("p",{className:"text-sm",children:(e==null?void 0:e.fullName)||"-"})]}),a.jsxs("div",{children:[a.jsx(x,{className:"text-muted-foreground text-sm font-medium",children:"Email"}),a.jsx("p",{className:"text-sm",children:t==null?void 0:t.email})]}),(e==null?void 0:e.updatedAt)&&a.jsxs("div",{children:[a.jsx(x,{className:"text-muted-foreground text-sm font-medium",children:"Last Updated"}),a.jsx("p",{className:"text-sm",children:new Date(e.updatedAt).toLocaleDateString()})]})]})})]}),a.jsx(j,{children:a.jsx(S,{className:"pt-6",children:a.jsxs(c,{onClick:F,variant:"destructive",size:"sm",className:"flex w-full items-center justify-center gap-2 hover:bg-red-500",children:[a.jsx(Q,{size:14}),"Logout"]})})}),a.jsx(V,{})]})]})}export{re as default};
